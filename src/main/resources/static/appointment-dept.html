<!doctype html>
<html class="no-js" lang="zxx">

<head>
    <!-- Meta Tags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="keywords" content="Site keywords here">
    <meta name="description" content="">
    <meta name='copyright' content=''>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Title -->
    <title></title>

    <!-- Favicon -->
    <link rel="icon" href="img/favicon.png">

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css?family=Poppins:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap"
        rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- Nice Select CSS -->
    <link rel="stylesheet" href="css/nice-select.css">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <!-- icofont CSS -->
    <link rel="stylesheet" href="css/icofont.css">
    <!-- Slicknav -->
    <link rel="stylesheet" href="css/slicknav.min.css">
    <!-- Owl Carousel CSS -->
    <link rel="stylesheet" href="css/owl-carousel.css">
    <!-- Datepicker CSS -->
    <link rel="stylesheet" href="css/datepicker.css">
    <!-- Animate CSS -->
    <link rel="stylesheet" href="css/animate.min.css">
    <!-- Magnific Popup CSS -->
    <link rel="stylesheet" href="css/magnific-popup.css">

    <!-- Medipro CSS -->
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/responsive.css">

    <!-- Color CSS -->
    <link rel="stylesheet" href="css/color/color1.css">
    <!--<link rel="stylesheet" href="css/color/color2.css">-->
    <!--<link rel="stylesheet" href="css/color/color3.css">-->
    <!--<link rel="stylesheet" href="css/color/color4.css">-->
    <!--<link rel="stylesheet" href="css/color/color5.css">-->
    <!--<link rel="stylesheet" href="css/color/color6.css">-->
    <!--<link rel="stylesheet" href="css/color/color7.css">-->
    <!--<link rel="stylesheet" href="css/color/color8.css">-->
    <!--<link rel="stylesheet" href="css/color/color9.css">-->
    <!--<link rel="stylesheet" href="css/color/color10.css">-->
    <!--<link rel="stylesheet" href="css/color/color11.css">-->
    <!--<link rel="stylesheet" href="css/color/color12.css">-->

    <link rel="stylesheet" href="#" id="colors">


</head>

<body>
    <!-- Header Area -->
    <header class="header style2">
        <!-- Middle Header -->
        <div class="middle-header">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3 col-md-3 col-12">
                        <!-- Start Logo -->
                        <div class="logo">
                            <a href="index2.html"><img src="img/logo.png" alt="#"></a>
                        </div>
                        <!-- End Logo -->
                        <!-- Mobile Nav -->
                        <div class="mobile-nav"></div>
                        <!-- End Mobile Nav -->
                    </div>
                    <div class="col-lg-9 col-md-9 col-12">
                        <div class="widget-main">
                            <!-- Single Widget -->
                            <div class="single-widget">
                                <i class="icofont-ui-call"></i>
                                <p>电话</p>
                                <h4>(023)6519 0120</h4>
                            </div>
                            <!--/ End Single Widget -->
                            <!-- Single Widget -->
                            <div class="single-widget">
                                <i class="icofont-location-pin"></i>
                                <p>地址</p>
                                <h4>重庆市沙坪坝区高滩岩正街30号</h4>
                            </div>
                            <!--/ End Single Widget -->
                            <!-- Single Widget -->
                            <!-- <div class="single-widget button">
									<div class="get-quote">
										<a href="#" class="btn">我的预约记录</a>
									</div>
								</div> -->
                            <!--/ End Single Widget -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Middle Header -->
        <!-- Header Inner -->
        <div class="header-inner">
            <div class="container">
                <div class="inner">
                    <div class="row">
                        <div class="col-12">
                            <!-- Main Menu -->
                            <div class="main-menu" style="float: left;">
                                <nav class="navigation">
                                    <ul class="nav menu">
                                        <li><a href="index2.html">首页</a></li>
                                        <li><a href="#">医院介绍</a></li>
                                        <li><a href="#">科室简介</a></li>
                                        <li><a href="#">专家教授</a></li>
                                        <li><a href="#">联系我们</a></li>
                                        <li><a href="#">员工入口</a></li>
                                    </ul>
                                </nav>
                            </div>
                            <div class="get-quote" style="float: right; margin-top: 10px;">
                                <a href="my.html" class="btn">预约记录</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--/ End Header Inner -->
    </header>
    <!-- End Header Area -->

    <!-- Start portfolio -->
    <section class="portfolio section" style="padding-top: 20px;">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div style="padding: 30px 10px; text-align: center; margin-bottom: 30px;">
                        <div style="float:left; margin-left: 15%; margin-right: 6%;">
                            <h3 id="step-dept" style="color: #1A76D1;">1. 选择科室</h3>
                        </div>
                        <div style="float:left;">
                            <h3 style="color: lightslategray;">></h3>
                        </div>

                        <div style="float: left; margin-left: 6%; margin-right: 6%;">
                            <h3 id="step-time" style="color: lightslategray;">2. 选择就诊时间</h3>
                        </div>
                        <div style="float:left;">
                            <h3 style="color: lightslategray;">></h3>
                        </div>

                        <div style="float: left; margin-left: 6%;">
                            <h3 id="step-done" style="color: lightslategray;">3. 提交预约</h3>
                        </div>
                    </div>
                </div>
            </div>


            <div id="option-dept" style="display: block;">
                <div class="row">
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="single-pf grid-dept">
                            <h1 class="name-dept">内科</h1>
                            <a href="#" class="btn" onclick="select_dept(this)">选择预约</a>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="single-pf grid-dept">
                            <h1 class="name-dept">外科</h1>
                            <a href="#" class="btn" onclick="select_dept(this)">选择预约</a>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="single-pf grid-dept">
                            <h1 class="name-dept">儿科</h1>
                            <a href="#" class="btn" onclick="select_dept(this)">选择预约</a>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="single-pf grid-dept">
                            <h1 class="name-dept">五官科</h1>
                            <a href="#" class="btn" onclick="select_dept(this)">选择预约</a>
                        </div>
                    </div>
                </div>

                <div class="row" style="margin-top: 20px;">
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="single-pf grid-dept">
                            <h1 class="name-dept">皮肤科</h1>
                            <a href="#" class="btn" onclick="select_dept(this)">选择预约</a>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="single-pf grid-dept">
                            <h1 class="name-dept">康复科</h1>
                            <a href="#" class="btn" onclick="select_dept(this)">选择预约</a>
                        </div>
                    </div>

                </div>
            </div>

            <div class="row" id="option-time" style="display: none;">
                <div style="padding: 20px;">
                    <h4>您已选择：<span id="selected-dept">五官科</span></h4>
                </div>

                <div>
                    <table class="table timetable" style="height: auto">
                        <colgroup>
                            <col style="width: 30%;"/>
                            <col style="width: 30%;"/>
                            <col style="width: 30%;"/>
                            <col style="width: 10%;"/>
                        </colgroup>
                        <thead>
                            <tr>
                                <th>日期</th>
                                <th>时间</th>
                                <th>可预约名额</th>
                                <th></th>
                            </tr>
                        </thead>
                    </table>
                </div>
                <div style="overflow-y: scroll; height: 400px;">
                    <table class="table timetable">
                        <colgroup>
                            <col style="width: 30%;"/>
                            <col style="width: 32%;"/>
                            <col style="width: 28%;"/>
                            <col style="width: 10%;"/>
                        </colgroup>
                        <tbody id="app-item-list">

                        </tbody>
                    </table>
                </div>
            </div>

            <div id="option-confirm" style="display: none;">
                <section id="team" class="team section single-page" style="padding-top: 0px;">
                    <div class="container">
                        <!-- Single Team -->
                        <div class="single-team" style="padding: 50px; text-align: left ;">
                            <div class="t-head" style="width: 30%; float: left;">
                                <img src="img/mission-img.jpg" alt="#">
                            </div>
                            <div style="float: left; margin-left: 60px;">
                                <h2>您选择预约：</h2>
                                <br>
                                <h3 id="confirm-dept">外科</h3>
                                <br>
                                <h3>就诊时间：<span id="confirm-time"></span></h3>
                                <button class="btn"
                                    style="margin: 50px; margin-left: 100px; width: 80%; font-size: 20px;"
                                    onclick="confirm()">确认预约</button>
                            </div>
                        </div>
                        <!-- End Single Team -->

                    </div>
            </div>
        </div>

    </section>
    <!--/ End portfolio -->

    <!-- Footer Area -->
    <footer id="footer" class="footer ">
        <!-- Footer Top -->
        <div class="footer-top">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="single-footer">
                            <h2>About Us</h2>
                            <p>Lorem ipsum dolor sit am consectetur adipisicing elit do eiusmod tempor incididunt ut
                                labore dolore magna.</p>
                            <!-- Social -->
                            <ul class="social">
                                <li><a href="#"><i class="icofont-facebook"></i></a></li>
                                <li><a href="#"><i class="icofont-google-plus"></i></a></li>
                                <li><a href="#"><i class="icofont-twitter"></i></a></li>
                                <li><a href="#"><i class="icofont-vimeo"></i></a></li>
                                <li><a href="#"><i class="icofont-pinterest"></i></a></li>
                            </ul>
                            <!-- End Social -->
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="single-footer f-link">
                            <h2>Quick Links</h2>
                            <div class="row">
                                <div class="col-lg-6 col-md-6 col-12">
                                    <ul>
                                        <li><a href="#"><i class="fa fa-caret-right" aria-hidden="true"></i>Home</a>
                                        </li>
                                        <li><a href="#"><i class="fa fa-caret-right" aria-hidden="true"></i>About Us</a>
                                        </li>
                                        <li><a href="#"><i class="fa fa-caret-right" aria-hidden="true"></i>Services</a>
                                        </li>
                                        <li><a href="#"><i class="fa fa-caret-right" aria-hidden="true"></i>Our
                                                Cases</a></li>
                                        <li><a href="#"><i class="fa fa-caret-right" aria-hidden="true"></i>Other
                                                Links</a></li>
                                    </ul>
                                </div>
                                <div class="col-lg-6 col-md-6 col-12">
                                    <ul>
                                        <li><a href="#"><i class="fa fa-caret-right"
                                                    aria-hidden="true"></i>Consuling</a></li>
                                        <li><a href="#"><i class="fa fa-caret-right" aria-hidden="true"></i>Finance</a>
                                        </li>
                                        <li><a href="#"><i class="fa fa-caret-right"
                                                    aria-hidden="true"></i>Testimonials</a></li>
                                        <li><a href="#"><i class="fa fa-caret-right" aria-hidden="true"></i>FAQ</a></li>
                                        <li><a href="#"><i class="fa fa-caret-right" aria-hidden="true"></i>Contact
                                                Us</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="single-footer">
                            <h2>Open Hours</h2>
                            <p>Lorem ipsum dolor sit ame consectetur adipisicing elit do eiusmod tempor incididunt.</p>
                            <ul class="time-sidual">
                                <li class="day">Monday - Fridayp <span>8.00-20.00</span></li>
                                <li class="day">Saturday <span>9.00-18.30</span></li>
                                <li class="day">Monday - Thusday <span>9.00-15.00</span></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="single-footer">
                            <h2>Newsletter</h2>
                            <p>subscribe to our newsletter to get allour news in your inbox.. Lorem ipsum dolor sit
                                amet, consectetur adipisicing elit,</p>
                            <form action="mail/mail.php" method="get" target="_blank" class="newsletter-inner">
                                <input name="email" placeholder="Email Address" class="common-input"
                                    onfocus="this.placeholder = ''" onblur="this.placeholder = 'Your email address'"
                                    required="" type="email">
                                <button class="button"><i class="icofont icofont-paper-plane"></i></button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--/ End Footer Top -->
        <!-- Copyright -->
        <div class="copyright">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-12">
                        <div class="copyright-content">
                            <p>Copyright &copy; 2020.Company name All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--/ End Copyright -->
    </footer>
    <!--/ End Footer Area -->

    <!-- jquery Min JS -->
    <script src="js/jquery.min.js"></script>
    <!-- jquery Migrate JS -->
    <script src="js/jquery-migrate-3.0.0.js"></script>
    <!-- jquery Ui JS -->
    <script src="js/jquery-ui.min.js"></script>
    <!-- Easing JS -->
    <script src="js/easing.js"></script>
    <!-- Color JS -->
    <script src="js/colors.js"></script>
    <!-- Popper JS -->
    <script src="js/popper.min.js"></script>
    <!-- Bootstrap Datepicker JS -->
    <script src="js/bootstrap-datepicker.js"></script>
    <!-- Jquery Nav JS -->
    <script src="js/jquery.nav.js"></script>
    <!-- Slicknav JS -->
    <script src="js/slicknav.min.js"></script>
    <!-- ScrollUp JS -->
    <script src="js/jquery.scrollUp.min.js"></script>
    <!-- Niceselect JS -->
    <script src="js/niceselect.js"></script>
    <!-- Tilt Jquery JS -->
    <script src="js/tilt.jquery.min.js"></script>
    <!-- Owl Carousel JS -->
    <script src="js/owl-carousel.js"></script>
    <!-- counterup JS -->
    <script src="js/jquery.counterup.min.js"></script>
    <!-- Steller JS -->
    <script src="js/steller.js"></script>
    <!-- Wow JS -->
    <script src="js/wow.min.js"></script>
    <!-- Magnific Popup JS -->
    <script src="js/jquery.magnific-popup.min.js"></script>
    <!-- Counter Up CDN JS -->
    <script src="js/waypoints.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="js/bootstrap.min.js"></script>
    <!-- Main JS -->
    <script src="js/main.js"></script>


    <style type="text/css">
        .grid-dept {
            height: 200px;
            width: 100%;
            display: table;
        }

        .name-dept {
            height: 100%;
            text-align: center;
            display: table-cell;
            vertical-align: middle;
            color: white;
            background-color: #1a76d1;
        }

        .timetable {
            color: black;
            font-size: 18px;
            margin-bottom: 0;
        }
    </style>

    <script>
        $(document).ready(function () {
            selectedDepartmentId = ''
            selectedTime = ''
            departmentId2Name = {
                'DE000001': '内科',
                'DE000002': '外科',
                'DE000003': '儿科',
                'DE000004': '五官科',
                'DE000005': '皮肤科',
                'DE000006': '康复科',
            }
            departmentName2Id = {
                '内科': 'DE000001',
                '外科': 'DE000002',
                '儿科': 'DE000003',
                '五官科': 'DE000004',
                '皮肤科': 'DE000005',
                '康复科': 'DE000006',
            }

        });

        function select_dept(e) {
            var deptName = $(e).parent().children()[0].innerHTML
            var deptId = departmentName2Id[deptName]
            console.log(deptName)
            selectedDepartmentId = deptId

            document.getElementById('option-dept').style.display = 'none';
            document.getElementById('option-time').style.display = 'block';
            document.getElementById('step-time').style.color = '#1A76D1';//选择就诊时间
            document.getElementById('step-dept').style.color = 'lightslategray';//选择科室

            $('#selected-dept').text(deptName)

            var monName = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']

            $.ajax({
                type: 'get',
                url: '/appoint_dept2?departmentId=' + deptId,
                dataType: 'json',
                async: false,
                success: function(data) {
                    for (let i = 0; i < data.length; i++) {
                        // {"remainDeptNumderId":1,"departmentId":"DE000001","time":"Jan 2, 2022, 9:00:00 AM","number":5},
                        var d = new Date(data[i].time)
                        var curtime = new Date().getTime()
                        var ans = curtime - data[i].time
                        if(ans>0){
                            continue
                        }
                        else{
                            var days=Math.floor(-ans/(24*3600*1000));
                            if (days>7)continue
                        }
                        var year = d.getFullYear()
                        var month = d.getMonth()+1
                        var day = d.getDate()
                        var date = year + '-' + month + '-' + day
                        var time = d.getHours()
                        if (time == '9') time = '09:00~09:59'
                        else time = time + ':00~' + time + ':59'

                        $('#app-item-list').append(
                            '<tr>' +
                                '<td>' + date + '</td>' +
                                '<td>' + time + '</td>' +
                                '<td>' + data[i].number + '</td>' +
                                '<td><button class="btn" onclick="select_time(this)">选择预约</button></td>' +
                            '</tr>'
                        )
                        
                    }
                    
                },
                error:function (){
                    alert(111)
                },
            })

        };

        function select_time(e) {
            var children = $(e).parent().parent().children()
			var date = children[0].innerHTML
			var time = children[1].innerHTML.substring(0, 5) + ':00'
			selectedTime = date + ' ' + time

            document.getElementById('step-done').style.color = '#1A76D1'
            document.getElementById('step-time').style.color = 'lightslategray';
            document.getElementById('option-time').style.display = 'none';
            document.getElementById('option-confirm').style.display = 'block';

            $('#confirm-dept').text(departmentId2Name[selectedDepartmentId])
			$('#confirm-time').text(selectedTime)
        };

        function confirm() {
            var data = {}
            data['departmentId'] = selectedDepartmentId
            data['reserveTime'] = selectedTime

            $.ajax({
                type: 'post',
                dataType: "json",
                url: "/appoint_dept_submit",
                cache: false,
                data: data,
                success: function (data) {
                    if(data.status == 'ok'){
                        console.log(data);
                        alert('预约成功！')
                        $(location).attr('href','/my.html')
                    }
                    else{
                        console.log(data);
                        alert(data.msg)
                        $(location).attr('href','/appointment-dept.html')
                    }
                }
            })
        }
    </script>



</body>


</html>