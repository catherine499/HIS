<html class="no-js" lang="zxx">

<head>
	<!-- Meta Tags -->
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="keywords" content="Site keywords here">
	<meta name="description" content="">
	<meta name='copyright' content=''>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Title -->
	<title></title>

	<!-- Favicon -->
	<link rel="icon" href="img/favicon.png">

	<!-- Google Fonts -->
	<link
		href="https://fonts.googleapis.com/css?family=Poppins:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap"
		rel="stylesheet">

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<!-- Nice Select CSS -->
	<link rel="stylesheet" href="css/nice-select.css">
	<!-- Font Awesome CSS -->
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<!-- icofont CSS -->
	<link rel="stylesheet" href="css/icofont.css">
	<!-- Slicknav -->
	<link rel="stylesheet" href="css/slicknav.min.css">
	<!-- Owl Carousel CSS -->
	<link rel="stylesheet" href="css/owl-carousel.css">
	<!-- Datepicker CSS -->
	<link rel="stylesheet" href="css/datepicker.css">
	<!-- Animate CSS -->
	<link rel="stylesheet" href="css/animate.min.css">
	<!-- Magnific Popup CSS -->
	<link rel="stylesheet" href="css/magnific-popup.css">

	<!-- Medipro CSS -->
	<link rel="stylesheet" href="css/normalize.css">
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="css/responsive.css">

	<!-- Color CSS -->
	<link rel="stylesheet" href="css/color/color1.css">
	<!--<link rel="stylesheet" href="css/color/color2.css">-->
	<!--<link rel="stylesheet" href="css/color/color3.css">-->
	<!--<link rel="stylesheet" href="css/color/color4.css">-->
	<!--<link rel="stylesheet" href="css/color/color5.css">-->
	<!--<link rel="stylesheet" href="css/color/color6.css">-->
	<!--<link rel="stylesheet" href="css/color/color7.css">-->
	<!--<link rel="stylesheet" href="css/color/color8.css">-->
	<!--<link rel="stylesheet" href="css/color/color9.css">-->
	<!--<link rel="stylesheet" href="css/color/color10.css">-->
	<!--<link rel="stylesheet" href="css/color/color11.css">-->
	<!--<link rel="stylesheet" href="css/color/color12.css">-->

	<link rel="stylesheet" href="#" id="colors">

</head>

<body>
	<!-- Header Area -->
	<header class="header style2">
		<!-- Middle Header -->
		<div class="middle-header">
			<div class="container">
				<div class="row">
					<div class="col-lg-3 col-md-3 col-12">
						<!-- Start Logo -->
						<div class="logo">
							<a href="index2.html"><img src="img/logo.png" alt="#"></a>
						</div>
						<!-- End Logo -->
						<!-- Mobile Nav -->
						<div class="mobile-nav"></div>
						<!-- End Mobile Nav -->
					</div>
					<div class="col-lg-9 col-md-9 col-12">
						<div class="widget-main">
							<!-- Single Widget -->
							<div class="single-widget">
								<i class="icofont-ui-call"></i>
								<p>电话</p>
								<h4>(023)6519 0120</h4>
							</div>
							<!--/ End Single Widget -->
							<!-- Single Widget -->
							<div class="single-widget">
								<i class="icofont-location-pin"></i>
								<p>地址</p>
								<h4>重庆市沙坪坝区高滩岩正街30号</h4>
							</div>
							<!--/ End Single Widget -->
							<!-- Single Widget -->
							<!-- <div class="single-widget button">
									<div class="get-quote">
										<a href="#" class="btn">我的预约记录</a>
									</div>
								</div> -->
							<!--/ End Single Widget -->
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- End Middle Header -->
		<!-- Header Inner -->
		<div class="header-inner">
			<div class="container">
				<div class="inner">
					<div class="row">
						<div class="col-12">
							<!-- Main Menu -->
							<div class="main-menu" style="float: left;">
								<nav class="navigation">
									<ul class="nav menu">
										<li><a href="index2.html">首页</a></li>
										<li><a href="#">医院介绍</a></li>
										<li><a href="#">科室简介</a></li>
										<li><a href="#">专家教授</a></li>
										<li><a href="#">联系我们</a></li>
										<li><a href="/login-staff.html">员工入口</a></li>
									</ul>
								</nav>
							</div>
							<div class="get-quote" style="float: right; margin-top: 10px;">
								<a href="my.html" class="btn">预约记录</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--/ End Header Inner -->
	</header>
	<!-- End Header Area -->

	<section class="doctor-calendar-area section" style="padding-top: 20px;">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div style="padding: 30px 10px; text-align: center; margin-bottom: 30px;">
						<div style="float:left; margin-left: 15%; margin-right: 6%;">
							<h3 id="step-doc" style="color: #1A76D1;">1. 选择专家</h3>
						</div>
						<div style="float:left;">
							<h3 style="color: lightslategray;">></h3>
						</div>

						<div style="float: left; margin-left: 6%; margin-right: 6%;">
							<h3 id="step-time" style="color: lightslategray;">2. 选择就诊时间</h3>
						</div>
						<div style="float:left;">
							<h3 style="color: lightslategray;">></h3>
						</div>

						<div style="float: left; margin-left: 6%;">
							<h3 id="step-done" style="color: lightslategray;">3. 提交预约</h3>
						</div>
					</div>
				</div>
			</div>

			<div class="row" id="option-doc-filter" style="display: flex;">
				<div class="col-lg-4 col-md-6 col-12">
					<div class="form-group">
						<div class="nice-select form-control wide" tabindex="0"><span class="current"
								id="selected-dept">所有科室</span>
							<ul class="list">
								<li data-value="0" class="option selected ">所有科室</li>
								<li data-value="1" class="option">内科</li>
								<li data-value="2" class="option">外科</li>
								<li data-value="3" class="option">儿科</li>
								<li data-value="4" class="option">五官科</li>
								<li data-value="5" class="option">皮肤科</li>
								<li data-value="6" class="option">康复科</li>
							</ul>
						</div>
					</div>
				</div>
				<!-- <div class="col-lg-4 col-md-6 col-12">
					<div class="form-group">
						<div class="nice-select form-control wide" tabindex="0"><span class="current">所有职称</span>
							<ul class="list">
								<li data-value="1" class="option selected ">所有职称</li>
								<li data-value="2" class="option">主任医师</li>
								<li data-value="3" class="option">副主任医师</li>
								<li data-value="4" class="option">主治医师</li>
								<li data-value="5" class="option">住院医师</li>
							</ul>
						</div>
					</div>
				</div> -->
				<div class="col-lg-4 col-md-6 col-12">
					<button class="btn" style="float: right; width: 100%;" onclick="filterDoctor()">筛选</button>

				</div>
			</div>

			<div class="row" id="option-doc" style="display: block;">
				<section id="team" class="team section single-page" style="padding-top: 0px;">
					<div class="container">
						<div class="row" id="doctor-list">
							
						</div>
					</div>
				</section>

			</div>

			<div class="row" id="option-time" style="display: none;">
				<div style="padding: 20px;">
					<h4>您已选择：<span id="selected-doctor"></span></h4>
				</div>
				<div>
					<table class="table timetable" style="height: auto">
						<colgroup>
							<col style="width: 30%;" />
							<col style="width: 30%;" />
							<col style="width: 30%;" />
							<col style="width: 10%;" />
						</colgroup>
						<thead>
							<tr>
								<th>日期</th>
								<th>时间</th>
								<th>可预约名额</th>
								<th></th>
							</tr>
						</thead>
					</table>
				</div>
				<div style="overflow-y: scroll; height: 400px;">
					<table class="table timetable">
						<colgroup>
							<col style="width: 30%;" />
							<col style="width: 32%;" />
							<col style="width: 28%;" />
							<col style="width: 10%;" />
						</colgroup>
						<tbody id="app-item-list">
						</tbody>
					</table>
				</div>
			</div>

			<div id="option-confirm" style="display: none;">
				<section id="team" class="team section single-page" style="padding-top: 0px;">
					<div class="container">
						<!-- Single Team -->
						<div class="single-team" style="padding: 50px; text-align: left ;">
							<div class="t-head" style="width: 30%; float: left;">
								<img src="img/team1.jpg" alt="#">
							</div>
							<div style="float: left; margin-left: 60px;">
								<h2>您选择预约：</h2>
								<br>
								<h3><span id="confirm-dept">外科</span> - <span id="confirm-doc">啊啊啊</span></h3>
								<br>
								<h3>就诊时间：<span id="confirm-time">2021年12月10日 09:00~09:59</span></h3>
								<button class="btn"
									type=button style="margin: 50px; margin-left: 100px; width: 80%; font-size: 20px;"
									onclick="confirm()">确认预约</button>
							</div>
						</div>
						<!-- End Single Team -->

					</div>
			</div>

	</section>


	</div>
	</section>
	<!-- End Doctor Calendar Area -->


	<!-- Footer Area -->
	<footer id="footer" class="footer ">
		<!-- Footer Top -->
		<div class="footer-top">
			<div class="container">
				<div class="row">
					<div class="col-lg-3 col-md-6 col-12">
						<div class="single-footer">
							<h2>About Us</h2>
							<p>Lorem ipsum dolor sit am consectetur adipisicing elit do eiusmod tempor incididunt ut
								labore dolore magna.</p>
							<!-- Social -->
							<ul class="social">
								<li><a href="#"><i class="icofont-facebook"></i></a></li>
								<li><a href="#"><i class="icofont-google-plus"></i></a></li>
								<li><a href="#"><i class="icofont-twitter"></i></a></li>
								<li><a href="#"><i class="icofont-vimeo"></i></a></li>
								<li><a href="#"><i class="icofont-pinterest"></i></a></li>
							</ul>
							<!-- End Social -->
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-12">
						<div class="single-footer f-link">
							<h2>Quick Links</h2>
							<div class="row">
								<div class="col-lg-6 col-md-6 col-12">
									<ul>
										<li><a href="#"><i class="fa fa-caret-right" aria-hidden="true"></i>Home</a>
										</li>
										<li><a href="#"><i class="fa fa-caret-right" aria-hidden="true"></i>About Us</a>
										</li>
										<li><a href="#"><i class="fa fa-caret-right" aria-hidden="true"></i>Services</a>
										</li>
										<li><a href="#"><i class="fa fa-caret-right" aria-hidden="true"></i>Our
												Cases</a></li>
										<li><a href="#"><i class="fa fa-caret-right" aria-hidden="true"></i>Other
												Links</a></li>
									</ul>
								</div>
								<div class="col-lg-6 col-md-6 col-12">
									<ul>
										<li><a href="#"><i class="fa fa-caret-right"
													aria-hidden="true"></i>Consuling</a></li>
										<li><a href="#"><i class="fa fa-caret-right" aria-hidden="true"></i>Finance</a>
										</li>
										<li><a href="#"><i class="fa fa-caret-right"
													aria-hidden="true"></i>Testimonials</a></li>
										<li><a href="#"><i class="fa fa-caret-right" aria-hidden="true"></i>FAQ</a></li>
										<li><a href="#"><i class="fa fa-caret-right" aria-hidden="true"></i>Contact
												Us</a></li>
									</ul>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-12">
						<div class="single-footer">
							<h2>Open Hours</h2>
							<p>Lorem ipsum dolor sit ame consectetur adipisicing elit do eiusmod tempor incididunt.</p>
							<ul class="time-sidual">
								<li class="day">Monday - Fridayp <span>8.00-20.00</span></li>
								<li class="day">Saturday <span>9.00-18.30</span></li>
								<li class="day">Monday - Thusday <span>9.00-15.00</span></li>
							</ul>
						</div>
					</div>
					<div class="col-lg-3 col-md-6 col-12">
						<div class="single-footer">
							<h2>Newsletter</h2>
							<p>subscribe to our newsletter to get allour news in your inbox.. Lorem ipsum dolor sit
								amet, consectetur adipisicing elit,</p>
							<form action="mail/mail.php" method="get" target="_blank" class="newsletter-inner">
								<input name="email" placeholder="Email Address" class="common-input"
									onfocus="this.placeholder = ''" onblur="this.placeholder = 'Your email address'"
									required="" type="email">
								<button class="button"><i class="icofont icofont-paper-plane"></i></button>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--/ End Footer Top -->
		<!-- Copyright -->
		<div class="copyright">
			<div class="container">
				<div class="row">
					<div class="col-lg-12 col-md-12 col-12">
						<div class="copyright-content">
							<p>Copyright &copy; 2020.Company name All rights reserved.</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--/ End Copyright -->
	</footer>
	<!--/ End Footer Area -->

	<!-- jquery Min JS -->
	<script src="js/jquery.min.js"></script>
	<!-- jquery Migrate JS -->
	<script src="js/jquery-migrate-3.0.0.js"></script>
	<!-- jquery Ui JS -->
	<script src="js/jquery-ui.min.js"></script>
	<!-- Easing JS -->
	<script src="js/easing.js"></script>
	<!-- Color JS -->
	<script src="js/colors.js"></script>
	<!-- Popper JS -->
	<script src="js/popper.min.js"></script>
	<!-- Bootstrap Datepicker JS -->
	<script src="js/bootstrap-datepicker.js"></script>
	<!-- Jquery Nav JS -->
	<script src="js/jquery.nav.js"></script>
	<!-- Slicknav JS -->
	<script src="js/slicknav.min.js"></script>
	<!-- ScrollUp JS -->
	<script src="js/jquery.scrollUp.min.js"></script>
	<!-- Niceselect JS -->
	<script src="js/niceselect.js"></script>
	<!-- Tilt Jquery JS -->
	<script src="js/tilt.jquery.min.js"></script>
	<!-- Owl Carousel JS -->
	<script src="js/owl-carousel.js"></script>
	<!-- counterup JS -->
	<script src="js/jquery.counterup.min.js"></script>
	<!-- Steller JS -->
	<script src="js/steller.js"></script>
	<!-- Wow JS -->
	<script src="js/wow.min.js"></script>
	<!-- Magnific Popup JS -->
	<script src="js/jquery.magnific-popup.min.js"></script>
	<!-- Counter Up CDN JS -->
	<script src="js/waypoints.min.js"></script>
	<!-- Bootstrap JS -->
	<script src="js/bootstrap.min.js"></script>
	<!-- Main JS -->
	<script src="js/main.js"></script>

	<style type="text/css">
		.timetable {
			color: black;
			font-size: 18px;
			margin-bottom: 0;
		}
	</style>

	<script>
		$(document).ready(function () {
			selectedDepartmentId = ''
			selectedDoctorId = ''
			selectedTime = ''
			doctorId2Name = {}
			departmentId2Name = {
				'DE000001': '内科',
				'DE000002': '外科',
				'DE000003': '儿科',
				'DE000004': '五官科',
				'DE000005': '皮肤科',
				'DE000006': '康复科',
			}
			departmentName2Id = {
				'内科': 'DE000001',
				'外科': 'DE000002',
				'儿科': 'DE000003',
				'五官科': 'DE000004',
				'皮肤科': 'DE000005',
				'康复科': 'DE000006',
			}

			department = {
				'DE000001': [],
				'DE000002': [],
				'DE000003': [],
				'DE000004': [],
				'DE000005': [],
				'DE000006': [],
			};

			$.ajax({
				type: 'get',
				async: false,
				dataType: 'json',
				url: '/appoint_doctor1',
				success: function (data) {
					for (let i = 0; i < data.length; i++) {
						department[data[i].departmentId].push({ 'id': data[i].doctorId, 'name': data[i].doctorName })
						doctorId2Name[data[i].doctorId] = data[i].doctorName
					}
				},
			})
		});

		function layoutAllDept() {
			$('#doctor-list').html('') // 清空内容
			// debugger
			for (let dept = 1; dept < 7; dept++) {
				var tmpDoctorList = department['DE00000' + dept]
				for (let doc = 0; doc < tmpDoctorList.length; doc++) {
					var doctorId = tmpDoctorList[doc].id
					var doctorName = tmpDoctorList[doc].name
					layoutDoctorGrid(doctorId, 'DE00000' + dept);
				}
			}
		}

		function layoutFilteredDept(dept) {
			$('#doctor-list').html('') // 清空内容
			var tmpDoctorList = department[dept]
			for (let doc = 0; doc < tmpDoctorList.length; doc++) {
				var doctorId = tmpDoctorList[doc].id
				var doctorName = tmpDoctorList[doc].name
				layoutDoctorGrid(doctorId, dept)
			}
		}

		function layoutDoctorGrid(doctorId, deptId) {
			// $('#doctor-list').html('') // 清空内容
			$('#doctor-list').append(
				'<div class="col-lg-3 col-md-6 col-12">' +
				'<div class="single-team"><div class="t-head">' +
				'<img src="img/team2.jpg" alt="#"><div class="t-icon">' +
				'<a href="#" class="btn" onclick="select_doc(\'' + doctorId + '\',\'' + deptId + '\')">选择预约</a></div></div>' +
				'<div class="t-bottom">' +
				'<h2>' + doctorId2Name[doctorId] + '</h2>' +
				'<p>' + departmentId2Name[deptId] + '</p>' +
				'</div></div></div>'
			)
		}

		function filterDoctor() {
			var deptName = $('#selected-dept').text()
			if (deptName == '所有科室') {
				layoutAllDept();
			} else {
				layoutFilteredDept(departmentName2Id[deptName])
			}
		};

		function select_doc(doctorId, deptId) {
			selectedDoctorId = doctorId
			selectedDepartmentId = deptId
			$('#selected-doctor').text(departmentId2Name[deptId] + '-' + doctorId2Name[doctorId])

			$.ajax({
				type: 'get',
				data:{
					"doctorId":doctorId,
				},
				url: '/appoint_doctor2' ,
				dataType: 'json',
				async: false,
				success: function (data) {
					for (let i = 0; i < data.length; i++) {
						// {"departmentId":"DE000001","doctorId":"D0001003","doctorName":"毛颖","time":"Jan 2, 2022, 9:00:00 AM","number":5}
						// var tmp = data[i].time.split(', ')
						// var year = tmp[1]
						// var month = monthName.indexOf(tmp[0].split[' '][0])
						// month = month < 10 ? '0' + month : month;
						// var day = tmp[0].split[' '][1] * 1
						// day = day < 10 ? '0' + day : day;
						// var date = year + '-' + month + '-' + day
						//
						// var time = tmp[2].split[' '][0].split[':'][0]
						var d = new Date(data[i].time);
						var year = d.getFullYear()
						var month = d.getMonth()+1
						var day = d.getDate()
						var date = year + '-' + month + '-' + day
						var time = d.getHours()
						if (time == '9') time = '09:00~09:59'
						else time = time + ':00~' + time + ':59'
						$('#app-item-list').append(
							'<tr>' +
							'<td>' + date + '</td>' +
							'<td>' + time + '</td>' +
							'<td>' + data[i].number + '</td>' +
							'<td><button class="btn" onclick="select_time(this)">选择预约</button></td>' +
							'</tr>'
						)

					}
				}
			})
			
			document.getElementById('option-doc').style.display = 'none';
			document.getElementById('option-doc-filter').style.display = 'none';
			document.getElementById('option-time').style.display = 'block';
			document.getElementById('step-time').style.color = '#1A76D1';
			document.getElementById('step-doc').style.color = 'lightslategray';

		};


		function select_time(e) {
			// debugger
			var children = $(e).parent().parent().children()
			var date = children[0].innerHTML
			var time = children[1].innerHTML.substring(0, 5) + ':00'
			selectedTime = date + ' ' + time
			console.log(selectedTime)
			document.getElementById('step-done').style.color = '#1A76D1'
			document.getElementById('step-time').style.color = 'lightslategray';
			document.getElementById('option-time').style.display = 'none';
			document.getElementById('option-confirm').style.display = 'block';

			
			$('#confirm-dept').text(departmentId2Name[selectedDepartmentId])
			$('#confirm-doc').text(doctorId2Name[selectedDoctorId])
			$('#confirm-time').text(selectedTime)
		};

		function confirm() {
			$.ajax({
				type: 'POST',
				dataType: 'json',
				data:{
					"departmentId":selectedDepartmentId,
					"doctorId": selectedDoctorId,
					"reserveTime":selectedTime,
				},
				url: '/appoint_doctor_submit',
				dataType:"json",
				success: function(data) {
					if(data.status == 'ok'){
						alert('预约成功！')
						$(location).attr('href','/my.html')
					}
					else{
						console.log(data);
						alert(data.msg)
						$(location).attr('href','/appointment-doc.html')
					}
				}
			})
		}



	</script>



</body>


</html>